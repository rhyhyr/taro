<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>도착지 선택</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f6fa;
    }

    #search-panel {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      width: 100%;
      height: 100%;
      padding: 40px 20px;
      box-sizing: border-box;
    }

    h2 {
      margin-top: 0;
      font-size: 24px;
      color: #333;
    }

    .input-display {
      font-size: 16px;
      color: #555;
      margin: 10px 0 20px 0;
      text-align: center;
    }

    .result-list {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
      max-width: 600px;
      max-height: 60vh;
      overflow-y: auto;
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
    }

    .result-list li {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }

    .result-list li:hover {
      background: #f0f0f0;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div id="search-panel">
    <h2>도착지 자동완성</h2>
    <div class="input-display" id="inputDisplay">로딩 중...</div>
    <ul class="result-list" id="endResults"></ul>
  </div>

  <script>
    const appKey = 'z1X5bjuncu1DaI5iBjpsr4lNU0JKTgEV9EqYsp50'; // Tmap API 키 입력

    document.addEventListener('DOMContentLoaded', function () {
      const inputText = localStorage.getItem('userInputText');
      const inputDisplay = document.getElementById('inputDisplay');
      const $endResults = $('#endResults');

      if (!inputText || inputText.trim().length < 2) {
        inputDisplay.textContent = '입력된 텍스트가 없거나 너무 짧습니다.';
        return;
      }

      inputDisplay.textContent = `입력된 검색어: "${inputText}"`;

      $.get('https://apis.openapi.sk.com/tmap/pois', {
        version: 1,
        searchKeyword: inputText.trim(),
        resCoordType: 'WGS84GEO',
        reqCoordType: 'WGS84GEO',
        count: 20,
        appKey: appKey
      }).done(res => {
        const pois = res.searchPoiInfo?.pois?.poi || [];
        $endResults.empty();

        if (pois.length === 0) {
          $("<li>").text("검색 결과가 없습니다").appendTo($endResults);
          return;
        }

        pois.forEach(poi => {
          $("<li>")
            .text(poi.name)
            .on("click", () => {
              const destX = poi.frontLon;
              const destY = poi.frontLat;

              // 다음 페이지로 좌표 전달
              window.location.href = `/transfer?x=${destX}&y=${destY}`;
            })
            .appendTo($endResults);
        });
      });
    });
  </script>
</body>
</html>
